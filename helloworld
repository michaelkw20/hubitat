definition(
    name: "Turn On/Off Switches with Temperature",
    namespace: "yournamespace",
    author: "Your Name",
    description: "Turn on/off switches based on temperature",
    category: "My Apps",
    iconUrl: "",
    iconX2Url: "",
    iconX3Url: ""
)

preferences {
    section("Switch Settings") {
        input "triggerSwitch", "capability.switch", title: "Select Trigger Switch", required: true
        input "switch1", "capability.switch", title: "Select Switch 1", required: true
        input "switch2", "capability.switch", title: "Select Switch 2", required: true
        input "switch3", "capability.switch", title: "Select Switch 3", required: true
    }
    section("Temperature Settings") {
        input "thermostat", "capability.thermostat", title: "Select Thermostat", required: true
    }
}

def installed() {
    subscribe(triggerSwitch, "switch.on", triggerSwitchHandler)
    subscribe(triggerSwitch, "switch.off", triggerSwitchHandler)
    log.info("Turn On/Off Switches with Temperature app installed. Logging enabled.")
    updateLoggingLevel(3) // Set logging level to 3 (info)
}

def updated() {
    unsubscribe()
    subscribe(triggerSwitch, "switch.on", triggerSwitchHandler)
    subscribe(triggerSwitch, "switch.off", triggerSwitchHandler)
}

def updateLoggingLevel(level) {
    sendLocationEvent(name: "logLevel", value: level.toString(), descriptionText: "Set logging level to ${level}")
    log.info("Logging level set to ${level}")
}

def triggerSwitchHandler(evt) {
    if (evt.value == "on") {
        if (isTemperatureAboveThreshold(8) && !switch2.currentSwitch == "on") {
            switch1.on()
            log.info("Turning on Switch 1: Wetting cooling pads")
            runIn(10, turnOnSwitch3)
            log.info("Starting fan in hi mode")
        } else if (!switch3.currentSwitch == "on" && !switch2.currentSwitch == "on" && isTemperatureAboveThreshold(2)) {
            switch1.on()
            log.info("Turning on Switch 1: Wetting cooling pads")
            runIn(10, turnOnSwitch2)
            log.info("Starting fan in lo mode")
        }
    } else {
        switch1.off()
        switch3.off()
        log.info("Turning off Switch 1 and Switch 3")
    }
}

def turnOnSwitch1() {
    if (isTemperatureAboveThreshold(2)) {
        switch1.on()
        log.info("Turning on Switch 1")
    } else {
        switch1.off()
        log.info("Turning off Switch 1")
    }
}

def turnOnSwitch2() {
    switch2.on()
    log.info("Turning on Switch 2: Starting fan in lo mode")
}

def isTemperatureAboveThreshold(threshold) {
    def currentTemperature = thermostat.currentValue("temperature")
    def coolingSetpoint = thermostat.currentValue("coolingSetpoint")
    def temperatureThreshold = coolingSetpoint + threshold
    return currentTemperature > temperatureThreshold
}
